-- Premium Gamepasses Script with Enhanced GUI
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local ContentProvider = game:GetService("ContentProvider")

-- Player
local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- GUI Variables
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PremiumGamepassesUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false -- Prevent GUI from disappearing on death
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- Variables
local activeTab = "Products"
local loopDelay = 0.1
local activeLoops = {}
local isDragging = false
local isMinimized = false
local dragStartPos = nil
local frameStartPos = nil
local originalSize = UDim2.new(0, 500, 0, 500)
local minimizedSize = UDim2.new(0, 300, 0, 40)
local notifications = {}
local loopNotifications = {}
local originalContentYSize = 0
local loopToggleButtons = {} -- Store toggle button states

-- Create main frame with premium glass effect
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = originalSize
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -250)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
MainFrame.BackgroundTransparency = 0.15
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

-- Advanced Glass Effect
local Glass = Instance.new("ImageLabel")
Glass.Name = "Glass"
Glass.Size = UDim2.new(1, 0, 1, 0)
Glass.BackgroundTransparency = 1
Glass.Image = "rbxassetid://8992230672"
Glass.ImageColor3 = Color3.fromRGB(20, 20, 30)
Glass.ImageTransparency = 0.05
Glass.ScaleType = Enum.ScaleType.Crop
Glass.TileSize = UDim2.new(0, 200, 0, 200)
Glass.Parent = MainFrame

-- Premium Corner
local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 18)
Corner.Parent = MainFrame

-- Neon Border
local Border = Instance.new("UIStroke")
Border.Name = "Border"
Border.Color = Color3.fromRGB(80, 120, 255)
Border.Thickness = 2
Border.Transparency = 0.3
Border.Parent = MainFrame

-- Glow Effect with Animation
local Glow = Instance.new("ImageLabel")
Glow.Name = "Glow"
Glow.BackgroundTransparency = 1
Glow.Size = UDim2.new(1, 50, 1, 50)
Glow.Position = UDim2.new(0, -25, 0, -25)
Glow.Image = "rbxassetid://8992230672"
Glow.ImageColor3 = Color3.fromRGB(0, 100, 255)
Glow.ImageTransparency = 0.85
Glow.ScaleType = Enum.ScaleType.Slice
Glow.SliceCenter = Rect.new(23, 23, 277, 277)
Glow.Parent = MainFrame

-- Animate glow
coroutine.wrap(function()
    while Glow and Glow.Parent do
        for i = 0, 1, 0.01 do
            if not Glow or not Glow.Parent then break end
            Glow.ImageTransparency = 0.85 + math.sin(tick()) * 0.1
            task.wait(0.03)
        end
    end
end)()

-- Premium Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
TitleBar.BackgroundTransparency = 0.3
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 18)
TitleCorner.Parent = TitleBar

-- Title with Gradient
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -100, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "FREE GAMEPASS GUI"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBlack
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextStrokeTransparency = 0.8
Title.Parent = TitleBar

-- Close Button with X symbol
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 32, 0, 32)
CloseButton.Position = UDim2.new(1, -36, 0.5, -16)
CloseButton.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
CloseButton.BackgroundTransparency = 0.3
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 100, 100)
CloseButton.TextSize = 16
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CloseButtonCorner = Instance.new("UICorner")
CloseButtonCorner.CornerRadius = UDim.new(0, 8)
CloseButtonCorner.Parent = CloseButton

-- Minimize Button with +/- symbols
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 32, 0, 32)
MinimizeButton.Position = UDim2.new(1, -74, 0.5, -16)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
MinimizeButton.BackgroundTransparency = 0.3
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(100, 200, 255)
MinimizeButton.TextSize = 20
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Parent = TitleBar

local MinimizeButtonCorner = Instance.new("UICorner")
MinimizeButtonCorner.CornerRadius = UDim.new(0, 8)
MinimizeButtonCorner.Parent = MinimizeButton

-- Premium Tabs Container
local TabsContainer = Instance.new("Frame")
TabsContainer.Name = "TabsContainer"
TabsContainer.Size = UDim2.new(1, -20, 0, 40)
TabsContainer.Position = UDim2.new(0, 10, 0, 50)
TabsContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
TabsContainer.BackgroundTransparency = 0.2
TabsContainer.BorderSizePixel = 0
TabsContainer.Parent = MainFrame

local TabsCorner = Instance.new("UICorner")
TabsCorner.CornerRadius = UDim.new(0, 12)
TabsCorner.Parent = TabsContainer

-- Premium Tab Buttons
local ProductsTab = Instance.new("TextButton")
ProductsTab.Name = "ProductsTab"
ProductsTab.Size = UDim2.new(0.5, -5, 1, 0)
ProductsTab.Position = UDim2.new(0, 5, 0, 0)
ProductsTab.BackgroundColor3 = Color3.fromRGB(60, 120, 255)
ProductsTab.BackgroundTransparency = 0.1
ProductsTab.BorderSizePixel = 0
ProductsTab.Text = " PRODUCTS"
ProductsTab.TextColor3 = Color3.fromRGB(255, 255, 255)
ProductsTab.TextSize = 14
ProductsTab.Font = Enum.Font.GothamBold
ProductsTab.TextTransparency = 0
ProductsTab.Parent = TabsContainer

local ProductsTabCorner = Instance.new("UICorner")
ProductsTabCorner.CornerRadius = UDim.new(0, 10)
ProductsTabCorner.Parent = ProductsTab

local LoopTab = Instance.new("TextButton")
LoopTab.Name = "LoopTab"
LoopTab.Size = UDim2.new(0.5, -5, 1, 0)
LoopTab.Position = UDim2.new(0.5, 0, 0, 0)
LoopTab.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
LoopTab.BackgroundTransparency = 0.4
LoopTab.BorderSizePixel = 0
LoopTab.Text = "LOOP BUY"
LoopTab.TextColor3 = Color3.fromRGB(180, 180, 200)
LoopTab.TextSize = 14
LoopTab.Font = Enum.Font.GothamBold
LoopTab.TextTransparency = 0.2
LoopTab.Parent = TabsContainer

local LoopTabCorner = Instance.new("UICorner")
LoopTabCorner.CornerRadius = UDim.new(0, 10)
LoopTabCorner.Parent = LoopTab

-- Main Content Container
local ContentContainer = Instance.new("Frame")
ContentContainer.Name = "ContentContainer"
ContentContainer.Size = UDim2.new(1, -20, 1, -110)
ContentContainer.Position = UDim2.new(0, 10, 0, 100)
ContentContainer.BackgroundTransparency = 1
ContentContainer.Visible = true
ContentContainer.Parent = MainFrame

originalContentYSize = ContentContainer.Size.Y.Offset

-- Products Tab Content
local ProductsContent = Instance.new("ScrollingFrame")
ProductsContent.Name = "ProductsContent"
ProductsContent.Size = UDim2.new(1, 0, 1, 0)
ProductsContent.BackgroundTransparency = 1
ProductsContent.BorderSizePixel = 0
ProductsContent.ScrollBarThickness = 6
ProductsContent.ScrollBarImageColor3 = Color3.fromRGB(100, 150, 255)
ProductsContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
ProductsContent.Visible = true
ProductsContent.Parent = ContentContainer

local ProductsListLayout = Instance.new("UIListLayout")
ProductsListLayout.Padding = UDim.new(0, 10)
ProductsListLayout.Parent = ProductsContent

-- Loop Buy Tab Content
local LoopContent = Instance.new("ScrollingFrame")
LoopContent.Name = "LoopContent"
LoopContent.Size = UDim2.new(1, 0, 1, 0)
LoopContent.BackgroundTransparency = 1
LoopContent.BorderSizePixel = 0
LoopContent.ScrollBarThickness = 6
LoopContent.ScrollBarImageColor3 = Color3.fromRGB(100, 255, 150)
LoopContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
LoopContent.Visible = false
LoopContent.Parent = ContentContainer

local LoopListLayout = Instance.new("UIListLayout")
LoopListLayout.Padding = UDim.new(0, 10)
LoopListLayout.Parent = LoopContent

-- Loop Buy Controls
local StopAllLoopsButton = Instance.new("TextButton")
StopAllLoopsButton.Name = "StopAllLoopsButton"
StopAllLoopsButton.Size = UDim2.new(1, 0, 0, 45)
StopAllLoopsButton.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
StopAllLoopsButton.BackgroundTransparency = 0.1
StopAllLoopsButton.BorderSizePixel = 0
StopAllLoopsButton.Text = "‚èπÔ∏è STOP ALL LOOPS"
StopAllLoopsButton.TextColor3 = Color3.fromRGB(255, 255, 255)
StopAllLoopsButton.TextSize = 15
StopAllLoopsButton.Font = Enum.Font.GothamBold
StopAllLoopsButton.Parent = LoopContent

local StopAllCorner = Instance.new("UICorner")
StopAllCorner.CornerRadius = UDim.new(0, 12)
StopAllCorner.Parent = StopAllLoopsButton

-- Delay Slider
local DelayContainer = Instance.new("Frame")
DelayContainer.Name = "DelayContainer"
DelayContainer.Size = UDim2.new(1, 0, 0, 75)
DelayContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
DelayContainer.BackgroundTransparency = 0.2
DelayContainer.BorderSizePixel = 0
DelayContainer.Parent = LoopContent

local DelayCorner = Instance.new("UICorner")
DelayCorner.CornerRadius = UDim.new(0, 12)
DelayCorner.Parent = DelayContainer

local DelayTitle = Instance.new("TextLabel")
DelayTitle.Name = "DelayTitle"
DelayTitle.Size = UDim2.new(1, -20, 0, 30)
DelayTitle.Position = UDim2.new(0, 10, 0, 5)
DelayTitle.BackgroundTransparency = 1
DelayTitle.Text = "LOOP DELAY(SECONDS)"
DelayTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
DelayTitle.TextSize = 15
DelayTitle.Font = Enum.Font.GothamBold
DelayTitle.TextXAlignment = Enum.TextXAlignment.Left
DelayTitle.Parent = DelayContainer

local DelayValue = Instance.new("TextLabel")
DelayValue.Name = "DelayValue"
DelayValue.Size = UDim2.new(0, 60, 0, 30)
DelayValue.Position = UDim2.new(1, -70, 0, 5)
DelayValue.BackgroundTransparency = 1
DelayValue.Text = "0.1s"
DelayValue.TextColor3 = Color3.fromRGB(100, 200, 255)
DelayValue.TextSize = 15
DelayValue.Font = Enum.Font.GothamBold
DelayValue.TextXAlignment = Enum.TextXAlignment.Right
DelayValue.Parent = DelayContainer

-- Premium Slider
local SliderTrack = Instance.new("Frame")
SliderTrack.Name = "SliderTrack"
SliderTrack.Size = UDim2.new(1, -20, 0, 8)
SliderTrack.Position = UDim2.new(0, 10, 0, 45)
SliderTrack.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
SliderTrack.BorderSizePixel = 0
SliderTrack.Parent = DelayContainer

local SliderCorner = Instance.new("UICorner")
SliderCorner.CornerRadius = UDim.new(1, 0)
SliderCorner.Parent = SliderTrack

local SliderFill = Instance.new("Frame")
SliderFill.Name = "SliderFill"
SliderFill.Size = UDim2.new(0.1, 0, 1, 0)
SliderFill.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
SliderFill.BorderSizePixel = 0
SliderFill.Parent = SliderTrack

local FillCorner = Instance.new("UICorner")
FillCorner.CornerRadius = UDim.new(1, 0)
FillCorner.Parent = SliderFill

local SliderButton = Instance.new("TextButton")
SliderButton.Name = "SliderButton"
SliderButton.Size = UDim2.new(0, 24, 0, 24)
SliderButton.Position = UDim2.new(0.1, -12, 0.5, -12)
SliderButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
SliderButton.BorderSizePixel = 0
SliderButton.Text = ""
SliderButton.ZIndex = 2
SliderButton.Parent = SliderTrack

local SliderButtonCorner = Instance.new("UICorner")
SliderButtonCorner.CornerRadius = UDim.new(1, 0)
SliderButtonCorner.Parent = SliderButton

-- Loop Items Label
local LoopItemsLabel = Instance.new("TextLabel")
LoopItemsLabel.Name = "LoopItemsLabel"
LoopItemsLabel.Size = UDim2.new(1, 0, 0, 35)
LoopItemsLabel.BackgroundTransparency = 1
LoopItemsLabel.Text = "ACTIVE LOOPS"
LoopItemsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
LoopItemsLabel.TextSize = 15
LoopItemsLabel.Font = Enum.Font.GothamBold
LoopItemsLabel.TextXAlignment = Enum.TextXAlignment.Left
LoopItemsLabel.Parent = LoopContent

-- Functions
local function CreateLoopNotification(productId, productName, isLooping)
    if loopNotifications[productId] then
        loopNotifications[productId]:Destroy()
        loopNotifications[productId] = nil
    end
    
    if isLooping then
        local Notification = Instance.new("Frame")
        Notification.Name = "LoopNotification_" .. productId
        Notification.Size = UDim2.new(0, 320, 0, 65)
        Notification.Position = UDim2.new(1, 10, 0, 10 + (#notifications * 75))
        Notification.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        Notification.BackgroundTransparency = 0.1
        Notification.BorderSizePixel = 0
        Notification.Parent = ScreenGui
        
        local NotifCorner = Instance.new("UICorner")
        NotifCorner.CornerRadius = UDim.new(0, 12)
        NotifCorner.Parent = Notification
        
        local NotifBorder = Instance.new("UIStroke")
        NotifBorder.Color = Color3.fromRGB(100, 200, 100)
        NotifBorder.Thickness = 2
        NotifBorder.Parent = Notification
        
        local Icon = Instance.new("TextLabel")
        Icon.Size = UDim2.new(0, 45, 1, 0)
        Icon.BackgroundTransparency = 1
        Icon.Text = "üîÑ"
        Icon.TextColor3 = Color3.fromRGB(100, 200, 100)
        Icon.TextSize = 26
        Icon.Font = Enum.Font.GothamBold
        Icon.Parent = Notification
        
        local TitleLabel = Instance.new("TextLabel")
        TitleLabel.Size = UDim2.new(1, -55, 0, 30)
        TitleLabel.Position = UDim2.new(0, 50, 0, 5)
        TitleLabel.BackgroundTransparency = 1
        TitleLabel.Text = productName
        TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        TitleLabel.TextSize = 15
        TitleLabel.Font = Enum.Font.GothamBold
        TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
        TitleLabel.TextTruncate = Enum.TextTruncate.AtEnd
        TitleLabel.Parent = Notification
        
        local StatusLabel = Instance.new("TextLabel")
        StatusLabel.Size = UDim2.new(1, -55, 0, 25)
        StatusLabel.Position = UDim2.new(0, 50, 0, 35)
        StatusLabel.BackgroundTransparency = 1
        StatusLabel.Text = "Looping... (" .. loopDelay .. "s)"
        StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        StatusLabel.TextSize = 13
        StatusLabel.Font = Enum.Font.Gotham
        StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
        StatusLabel.Parent = Notification
        
        -- Pulse animation
        coroutine.wrap(function()
            while Notification and Notification.Parent do
                local time = tick()
                local pulse = (math.sin(time * 3) + 1) / 2
                NotifBorder.Transparency = 0.3 + pulse * 0.4
                task.wait(0.03)
            end
        end)()
        
        Notification.Position = UDim2.new(1, 10, 0, 10 + (#notifications * 75))
        local tween = TweenService:Create(Notification, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Position = UDim2.new(1, -330, 0, 10 + (#notifications * 75))
        })
        tween:Play()
        
        table.insert(notifications, Notification)
        loopNotifications[productId] = Notification
    end
end

local function CreateNotification(title, message, color, icon)
    local Notification = Instance.new("Frame")
    Notification.Name = "Notification"
    Notification.Size = UDim2.new(0, 320, 0, 65)
    Notification.Position = UDim2.new(1, 10, 0, 10)
    Notification.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    Notification.BackgroundTransparency = 0.1
    Notification.BorderSizePixel = 0
    Notification.Parent = ScreenGui
    
    local NotifCorner = Instance.new("UICorner")
    NotifCorner.CornerRadius = UDim.new(0, 12)
    NotifCorner.Parent = Notification
    
    local IconLabel = Instance.new("TextLabel")
    IconLabel.Size = UDim2.new(0, 45, 1, 0)
    IconLabel.BackgroundTransparency = 1
    IconLabel.Text = icon or "‚ÑπÔ∏è"
    IconLabel.TextColor3 = color or Color3.fromRGB(255, 255, 255)
    IconLabel.TextSize = 26
    IconLabel.Font = Enum.Font.GothamBold
    IconLabel.Parent = Notification
    
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -55, 0, 30)
    TitleLabel.Position = UDim2.new(0, 50, 0, 5)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.TextSize = 15
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Notification
    
    local MessageLabel = Instance.new("TextLabel")
    MessageLabel.Size = UDim2.new(1, -55, 0, 25)
    MessageLabel.Position = UDim2.new(0, 50, 0, 35)
    MessageLabel.BackgroundTransparency = 1
    MessageLabel.Text = message
    MessageLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    MessageLabel.TextSize = 13
    MessageLabel.Font = Enum.Font.Gotham
    MessageLabel.TextXAlignment = Enum.TextXAlignment.Left
    MessageLabel.Parent = Notification
    
    Notification.Position = UDim2.new(1, 10, 0, 10)
    local tween = TweenService:Create(Notification, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(1, -330, 0, 10)
    })
    tween:Play()
    
    task.delay(3, function()
        if Notification and Notification.Parent then
            local tweenOut = TweenService:Create(Notification, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Position = UDim2.new(1, 10, 0, 10)
            })
            tweenOut:Play()
            tweenOut.Completed:Connect(function()
                Notification:Destroy()
            end)
        end
    end)
end

local function UpdateSlider(value)
    value = math.clamp(value, 0, 1)
    loopDelay = math.round((value * 4.9 + 0.1) * 10) / 10
    SliderFill.Size = UDim2.new(value, 0, 1, 0)
    SliderButton.Position = UDim2.new(value, -12, 0.5, -12)
    DelayValue.Text = loopDelay .. "s"
    
    for productId, notification in pairs(loopNotifications) do
        if notification and notification:FindFirstChild("StatusLabel") then
            notification.StatusLabel.Text = "Looping... (" .. loopDelay .. "s)"
        end
    end
end

local function StartLoop(productId, productName)
    if activeLoops[productId] then
        activeLoops[productId] = false
        task.wait(0.1)
    end
    
    activeLoops[productId] = true
    CreateLoopNotification(productId, productName, true)
    
    coroutine.wrap(function()
        while activeLoops[productId] do
            MarketplaceService:SignalPromptProductPurchaseFinished(player.UserId, productId, true)
            task.wait(loopDelay)
        end
        CreateNotification("Loop Stopped", productName .. " loop stopped", Color3.fromRGB(255, 100, 100), "‚èπÔ∏è")
    end)()
end

local function StopLoop(productId, productName)
    if activeLoops[productId] then
        activeLoops[productId] = false
    end
end

local function ResetAllToggles()
    -- Reset all toggle button visual states
    for productId, toggleData in pairs(loopToggleButtons) do
        if toggleData and toggleData.ToggleButton and toggleData.ToggleButton.Parent then
            -- Reset toggle position to left (off)
            TweenService:Create(toggleData.ToggleButton, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Position = UDim2.new(0, 2, 0.5, -12),
                BackgroundColor3 = Color3.fromRGB(220, 70, 70)
            }):Play()
            
            -- Reset background color
            if toggleData.ToggleBackground then
                TweenService:Create(toggleData.ToggleBackground, TweenInfo.new(0.3), {
                    BackgroundColor3 = Color3.fromRGB(60, 60, 80)
                }):Play()
            end
            
            -- Update internal state
            if toggleData.UpdateState then
                toggleData.UpdateState(false)
            end
        end
    end
end

local function StopAllLoops()
    -- Stop all loops
    for productId, _ in pairs(activeLoops) do
        activeLoops[productId] = false
    end
    
    -- Reset all toggle buttons visually
    ResetAllToggles()
    
    -- Remove all notifications
    for _, notification in pairs(loopNotifications) do
        if notification then
            notification:Destroy()
        end
    end
    loopNotifications = {}
    
    CreateNotification("Loop Buy", "All loops stopped & toggles reset", Color3.fromRGB(255, 100, 100), "‚èπÔ∏è")
end

local function CreateProductButton(devProduct)
    local id = devProduct.ProductId or 0
    local name = devProduct.Name or "Unnamed Product"
    local desc = devProduct.Description or "No description available"
    local price = devProduct.PriceInRobux or 0
    
    if #desc > 40 then
        desc = desc:sub(1, 37) .. "..."
    end
    
    local ButtonFrame = Instance.new("Frame")
    ButtonFrame.Name = "ProductButton"
    ButtonFrame.Size = UDim2.new(1, 0, 0, 75)
    ButtonFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    ButtonFrame.BackgroundTransparency = 0.2
    ButtonFrame.BorderSizePixel = 0
    ButtonFrame.Parent = ProductsContent
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 12)
    ButtonCorner.Parent = ButtonFrame
    
    local Button = Instance.new("TextButton")
    Button.Name = "Button"
    Button.Size = UDim2.new(1, 0, 1, 0)
    Button.BackgroundTransparency = 1
    Button.Text = ""
    Button.Parent = ButtonFrame
    
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Size = UDim2.new(1, -130, 0, 30)
    Title.Position = UDim2.new(0, 10, 0, 5)
    Title.BackgroundTransparency = 1
    Title.Text = name
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 16
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.TextTruncate = Enum.TextTruncate.AtEnd
    Title.Parent = ButtonFrame
    
    local Price = Instance.new("TextLabel")
    Price.Name = "Price"
    Price.Size = UDim2.new(0, 120, 0, 30)
    Price.Position = UDim2.new(1, -130, 0, 5)
    Price.BackgroundTransparency = 1
    Price.Text = "R$" .. tostring(price)
    Price.TextColor3 = Color3.fromRGB(100, 200, 100)
    Price.TextSize = 15
    Price.Font = Enum.Font.GothamBold
    Price.TextXAlignment = Enum.TextXAlignment.Right
    Price.Parent = ButtonFrame
    
    local Description = Instance.new("TextLabel")
    Description.Name = "Description"
    Description.Size = UDim2.new(1, -20, 0, 25)
    Description.Position = UDim2.new(0, 10, 0, 35)
    Description.BackgroundTransparency = 1
    Description.Text = desc
    Description.TextColor3 = Color3.fromRGB(180, 180, 180)
    Description.TextSize = 13
    Description.Font = Enum.Font.Gotham
    Description.TextXAlignment = Enum.TextXAlignment.Left
    Description.TextTruncate = Enum.TextTruncate.AtEnd
    Description.Parent = ButtonFrame
    
    local IDLabel = Instance.new("TextLabel")
    IDLabel.Name = "IDLabel"
    IDLabel.Size = UDim2.new(1, -20, 0, 20)
    IDLabel.Position = UDim2.new(0, 10, 1, -25)
    IDLabel.BackgroundTransparency = 1
    IDLabel.Text = "ID: " .. tostring(id)
    IDLabel.TextColor3 = Color3.fromRGB(100, 150, 255)
    IDLabel.TextSize = 12
    IDLabel.Font = Enum.Font.Gotham
    IDLabel.TextXAlignment = Enum.TextXAlignment.Left
    IDLabel.TextTruncate = Enum.TextTruncate.AtEnd
    IDLabel.Parent = ButtonFrame
    
    local ClickEffect = Instance.new("Frame")
    ClickEffect.Size = UDim2.new(0, 0, 0, 0)
    ClickEffect.Position = UDim2.new(0.5, 0, 0.5, 0)
    ClickEffect.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ClickEffect.BackgroundTransparency = 0.8
    ClickEffect.BorderSizePixel = 0
    ClickEffect.ZIndex = 2
    ClickEffect.Parent = ButtonFrame
    
    local ClickEffectCorner = Instance.new("UICorner")
    ClickEffectCorner.CornerRadius = UDim.new(1, 0)
    ClickEffectCorner.Parent = ClickEffect
    
    -- Hover effects
    Button.MouseEnter:Connect(function()
        TweenService:Create(ButtonFrame, TweenInfo.new(0.3), {
            BackgroundTransparency = 0.1,
            BackgroundColor3 = Color3.fromRGB(45, 45, 65)
        }):Play()
    end)
    
    Button.MouseLeave:Connect(function()
        TweenService:Create(ButtonFrame, TweenInfo.new(0.3), {
            BackgroundTransparency = 0.2,
            BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        }):Play()
    end)
    
    Button.MouseButton1Click:Connect(function()
        ClickEffect.Size = UDim2.new(0, 0, 0, 0)
        ClickEffect.Position = UDim2.new(0.5, 0, 0.5, 0)
        ClickEffect.BackgroundTransparency = 0.8
        
        TweenService:Create(ClickEffect, TweenInfo.new(0.4), {
            Size = UDim2.new(2, 0, 2, 0),
            Position = UDim2.new(-0.5, 0, -0.5, 0),
            BackgroundTransparency = 1
        }):Play()
        
        MarketplaceService:SignalPromptProductPurchaseFinished(player.UserId, id, true)
        CreateNotification("Purchase", name .. " purchased!", Color3.fromRGB(100, 200, 255), "‚úÖ")
    end)
end

local function CreateLoopToggle(devProduct)
    local id = devProduct.ProductId or 0
    local name = devProduct.Name or "Unnamed Product"
    local price = devProduct.PriceInRobux or 0
    
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Name = "LoopToggle"
    ToggleFrame.Size = UDim2.new(1, 0, 0, 55)
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    ToggleFrame.BackgroundTransparency = 0.2
    ToggleFrame.BorderSizePixel = 0
    ToggleFrame.Parent = LoopContent
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 12)
    ToggleCorner.Parent = ToggleFrame
    
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Size = UDim2.new(1, -80, 1, 0)
    Title.Position = UDim2.new(0, 10, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = name .. " [R$" .. tostring(price) .. "]"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 15
    Title.Font = Enum.Font.Gotham
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.TextTruncate = Enum.TextTruncate.AtEnd
    Title.Parent = ToggleFrame
    
    local ToggleBackground = Instance.new("Frame")
    ToggleBackground.Name = "ToggleBackground"
    ToggleBackground.Size = UDim2.new(0, 55, 0, 28)
    ToggleBackground.Position = UDim2.new(1, -65, 0.5, -14)
    ToggleBackground.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    ToggleBackground.BorderSizePixel = 0
    ToggleBackground.Parent = ToggleFrame
    
    local ToggleBGCorner = Instance.new("UICorner")
    ToggleBGCorner.CornerRadius = UDim.new(1, 0)
    ToggleBGCorner.Parent = ToggleBackground
    
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Name = "ToggleButton"
    ToggleButton.Size = UDim2.new(0, 24, 0, 24)
    ToggleButton.Position = UDim2.new(0, 2, 0.5, -12)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
    ToggleButton.BorderSizePixel = 0
    ToggleButton.Text = ""
    ToggleButton.ZIndex = 2
    ToggleButton.Parent = ToggleBackground
    
    local ToggleButtonCorner = Instance.new("UICorner")
    ToggleButtonCorner.CornerRadius = UDim.new(1, 0)
    ToggleButtonCorner.Parent = ToggleButton
    
    local isToggled = false
    
    -- Store toggle data for resetting
    loopToggleButtons[id] = {
        ToggleButton = ToggleButton,
        ToggleBackground = ToggleBackground,
        UpdateState = function(state)
            isToggled = state
        end
    }
    
    local function UpdateToggle()
        if isToggled then
            -- Move to right (on)
            TweenService:Create(ToggleButton, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Position = UDim2.new(1, -26, 0.5, -12),
                BackgroundColor3 = Color3.fromRGB(70, 220, 100)
            }):Play()
            TweenService:Create(ToggleBackground, TweenInfo.new(0.3), {
                BackgroundColor3 = Color3.fromRGB(40, 80, 40)
            }):Play()
            StartLoop(id, name)
        else
            -- Move to left (off)
            TweenService:Create(ToggleButton, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Position = UDim2.new(0, 2, 0.5, -12),
                BackgroundColor3 = Color3.fromRGB(220, 70, 70)
            }):Play()
            TweenService:Create(ToggleBackground, TweenInfo.new(0.3), {
                BackgroundColor3 = Color3.fromRGB(60, 60, 80)
            }):Play()
            StopLoop(id, name)
        end
    end
    
    ToggleButton.MouseButton1Click:Connect(function()
        isToggled = not isToggled
        UpdateToggle()
    end)
    
    ToggleFrame.MouseEnter:Connect(function()
        TweenService:Create(ToggleFrame, TweenInfo.new(0.3), {
            BackgroundTransparency = 0.1,
            BackgroundColor3 = Color3.fromRGB(45, 45, 65)
        }):Play()
    end)
    
    ToggleFrame.MouseLeave:Connect(function()
        TweenService:Create(ToggleFrame, TweenInfo.new(0.3), {
            BackgroundTransparency = 0.2,
            BackgroundColor3 = Color3.fromRGB(35, 35, 50)
        }):Play()
    end)
end

local function SwitchTab(tabName)
    if tabName == "Products" then
        TweenService:Create(ProductsTab, TweenInfo.new(0.4), {
            BackgroundColor3 = Color3.fromRGB(60, 120, 255),
            BackgroundTransparency = 0.1,
            TextColor3 = Color3.fromRGB(255, 255, 255),
            TextTransparency = 0
        }):Play()
        
        TweenService:Create(LoopTab, TweenInfo.new(0.4), {
            BackgroundColor3 = Color3.fromRGB(35, 35, 55),
            BackgroundTransparency = 0.4,
            TextColor3 = Color3.fromRGB(180, 180, 200),
            TextTransparency = 0.2
        }):Play()
        
        ProductsContent.Visible = true
        LoopContent.Visible = false
        activeTab = "Products"
    else
        TweenService:Create(LoopTab, TweenInfo.new(0.4), {
            BackgroundColor3 = Color3.fromRGB(70, 220, 100),
            BackgroundTransparency = 0.1,
            TextColor3 = Color3.fromRGB(255, 255, 255),
            TextTransparency = 0
        }):Play()
        
        TweenService:Create(ProductsTab, TweenInfo.new(0.4), {
            BackgroundColor3 = Color3.fromRGB(35, 35, 55),
            BackgroundTransparency = 0.4,
            TextColor3 = Color3.fromRGB(180, 180, 200),
            TextTransparency = 0.2
        }):Play()
        
        ProductsContent.Visible = false
        LoopContent.Visible = true
        activeTab = "Loop"
    end
end

local function ToggleMinimize()
    if isMinimized then
        -- Restore GUI
        MinimizeButton.Text = "-"
        TweenService:Create(MinimizeButton, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(45, 45, 60),
            TextColor3 = Color3.fromRGB(100, 200, 255)
        }):Play()
        
        ContentContainer.Visible = true
        TabsContainer.Visible = true
        
        TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = originalSize,
            Position = UDim2.new(0.5, -250, 0.5, -250)
        }):Play()
        
        isMinimized = false
    else
        -- Minimize GUI
        MinimizeButton.Text = "+"
        TweenService:Create(MinimizeButton, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(70, 220, 100),
            TextColor3 = Color3.fromRGB(255, 255, 255)
        }):Play()
        
        ContentContainer.Visible = false
        TabsContainer.Visible = false
        
        TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = minimizedSize,
            Position = UDim2.new(0.5, -150, 0.1, 10)
        }):Play()
        
        isMinimized = true
    end
end

-- Initialize
local function Initialize()
    local success, developerProducts = pcall(function()
        return MarketplaceService:GetDeveloperProductsAsync():GetCurrentPage()
    end)
    
    if success and developerProducts then
        for _, devProduct in pairs(developerProducts) do
            CreateProductButton(devProduct)
            CreateLoopToggle(devProduct)
        end
        
        CreateNotification("Success", "Loaded " .. #developerProducts .. " products", Color3.fromRGB(100, 200, 100), "‚úÖ")
    else
        CreateNotification("Error", "Failed to load products", Color3.fromRGB(255, 100, 100), "‚ùå")
    end
end

-- Events
CloseButton.MouseButton1Click:Connect(function()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(255, 80, 80),
        TextColor3 = Color3.fromRGB(255, 255, 255),
        Size = UDim2.new(0, 36, 0, 36)
    }):Play()
    
    TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    }):Play()
    
    task.delay(0.4, function()
        ScreenGui:Destroy()
    end)
end)

CloseButton.MouseEnter:Connect(function()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(255, 100, 100),
        Size = UDim2.new(0, 34, 0, 34)
    }):Play()
end)

CloseButton.MouseLeave:Connect(function()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {
        BackgroundColor3 = Color3.fromRGB(45, 45, 60),
        Size = UDim2.new(0, 32, 0, 32)
    }):Play()
end)

MinimizeButton.MouseButton1Click:Connect(ToggleMinimize)

MinimizeButton.MouseEnter:Connect(function()
    if isMinimized then
        TweenService:Create(MinimizeButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(80, 240, 120),
            Size = UDim2.new(0, 34, 0, 34)
        }):Play()
    else
        TweenService:Create(MinimizeButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(55, 55, 75),
            Size = UDim2.new(0, 34, 0, 34)
        }):Play()
    end
end)

MinimizeButton.MouseLeave:Connect(function()
    if isMinimized then
        TweenService:Create(MinimizeButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(70, 220, 100),
            Size = UDim2.new(0, 32, 0, 32)
        }):Play()
    else
        TweenService:Create(MinimizeButton, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(45, 45, 60),
            Size = UDim2.new(0, 32, 0, 32)
        }):Play()
    end
end)

ProductsTab.MouseButton1Click:Connect(function()
    SwitchTab("Products")
end)

LoopTab.MouseButton1Click:Connect(function()
    SwitchTab("Loop")
end)

StopAllLoopsButton.MouseButton1Click:Connect(StopAllLoops)

StopAllLoopsButton.MouseEnter:Connect(function()
    TweenService:Create(StopAllLoopsButton, TweenInfo.new(0.3), {
        BackgroundTransparency = 0.05,
        BackgroundColor3 = Color3.fromRGB(240, 90, 90)
    }):Play()
end)

StopAllLoopsButton.MouseLeave:Connect(function()
    TweenService:Create(StopAllLoopsButton, TweenInfo.new(0.3), {
        BackgroundTransparency = 0.1,
        BackgroundColor3 = Color3.fromRGB(220, 70, 70)
    }):Play()
end)

-- Slider dragging
local isSliding = false

SliderButton.MouseButton1Down:Connect(function()
    isSliding = true
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isSliding = false
    end
end)

RunService.RenderStepped:Connect(function()
    if isSliding then
        local mousePos = UserInputService:GetMouseLocation()
        local trackPos = SliderTrack.AbsolutePosition
        local trackSize = SliderTrack.AbsoluteSize
        local relativeX = math.clamp((mousePos.X - trackPos.X) / trackSize.X, 0, 1)
        UpdateSlider(relativeX)
    end
end)

-- Window dragging
TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDragging = true
        dragStartPos = UserInputService:GetMouseLocation()
        frameStartPos = MainFrame.Position
        
        TweenService:Create(MainFrame, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.1
        }):Play()
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        isDragging = false
        TweenService:Create(MainFrame, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.15
        }):Play()
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        if isDragging then
            local mousePos = UserInputService:GetMouseLocation()
            local delta = mousePos - dragStartPos
            MainFrame.Position = UDim2.new(
                frameStartPos.X.Scale,
                frameStartPos.X.Offset + delta.X,
                frameStartPos.Y.Scale,
                frameStartPos.Y.Offset + delta.Y
            )
        end
    end
end)

-- Initialize
Initialize()

-- Clean up
ScreenGui.Destroying:Connect(function()
    StopAllLoops()
end)

-- Bounce animation on load
task.wait(0.5)
MainFrame.Position = UDim2.new(0.5, -250, 0.2, -300)
TweenService:Create(MainFrame, TweenInfo.new(1, Enum.EasingStyle.Bounce, Enum.EasingDirection.Out), {
    Position = UDim2.new(0.5, -250, 0.5, -250)
}):Play()
